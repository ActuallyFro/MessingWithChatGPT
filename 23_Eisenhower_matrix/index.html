<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eisenhower Matrix SPA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-wrap: wrap;
            height: 100vh;
            margin: 0;
        }
        .quadrant {
            width: 50%;
            height: 50%;
            position: relative;
            box-sizing: border-box;
            padding: 1rem;
            border: 1px solid #ccc;
        }
        .quadrant h2 {
            margin: 0 0 1rem;
            font-size: 1.2rem;
        }
        .plus {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
        }
        .card {
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: #f0f0f0;
            margin-bottom: 0.5rem;
            position: relative;
            cursor: move;
        }
        .minus {
            position: absolute;
            top: 0;
            right: 0;
            font-size: 1.2rem;
            cursor: pointer;
        }
        .card-body {
            display: none;
            margin-top: 0.5rem;
            white-space: pre-wrap;
        }

        .card:hover .card-body {
            display: block;
        }

        .card.disable-hover .card-body {
            display: block;
        }

        input[type="text"] {
            font-family: inherit;
            font-size: inherit;
            background-color: transparent;
            border: none;
            outline: none;
            width: 100%;
        }

        input[type="text"]:focus {
            outline: auto;
        }

    </style>
</head>
<body>
    <div class="quadrant" id="q1">
        <h2>Important & Urgent</h2>
        <span class="plus">+</span>
    </div>
    <div class="quadrant" id="q2">
        <h2>Important & Not Urgent</h2>
        <span class="plus">+</span>
    </div>
    <div class="quadrant" id="q3">
        <h2>Not Important & Urgent</h2>
        <span class="plus">+</span>
    </div>
    <div class="quadrant" id="q4">
        <h2>Not Important & Not Urgent</h2>
        <span class="plus">+</span>
    </div>

    <script>
        document.querySelectorAll(".plus").forEach(plus => {
            plus.addEventListener("click", (e) => {
                const quadrant = e.target.parentElement;
                const card = createCard();
                quadrant.appendChild(card);
            });
        });

        function createCard() {
            const card = document.createElement("div");
            card.className = "card";
            card.setAttribute("draggable", "true");

            const input = document.createElement("input");
            input.type = "text";
            input.placeholder = "Label...";
            card.appendChild(input);

            const minus = document.createElement("span");
            minus.textContent = "-";
            minus.className = "minus";
            minus.addEventListener("click", () => {
                card.remove();
            });
            card.appendChild(minus);

            const edit = document.createElement("span");
            edit.textContent = "ðŸ“";
            edit.className = "edit";
            edit.style.marginLeft = "0.5rem";
            edit.addEventListener("click", () => {
                cardBody.style.display = cardBody.style.display === 'none' ? 'block' : 'none';
            });
            card.appendChild(edit);

            const viewAsHtmlIcon = document.createElement("i");
            viewAsHtmlIcon.className = "fas fa-eye view-as-html";
            viewAsHtmlIcon.style.marginLeft = "0.5rem";
            card.appendChild(viewAsHtmlIcon);

            const editIcon = document.createElement("i");
            editIcon.className = "fas fa-edit edit";
            editIcon.style.display = "none";
            editIcon.style.marginLeft = "0.5rem";
            card.appendChild(editIcon);


            let cardBody = document.createElement("textarea");
            cardBody.className = "card-body";
            cardBody.placeholder = "Enter description...";
            card.appendChild(cardBody);

            card.addEventListener("dragstart", (e) => {
                e.dataTransfer.setData("text", e.target.id);
            });


            viewAsHtmlIcon.addEventListener("click", () => {
                if (cardBody.tagName === "TEXTAREA") {
                    const sanitizedHtml = sanitizeHTML(cardBody.value);
                    const renderedHtml = document.createElement("div");
                    renderedHtml.className = "card-body";
                    renderedHtml.innerHTML = sanitizedHtml;
                    card.replaceChild(renderedHtml, cardBody);
                    cardBody = renderedHtml;
                    viewAsHtmlIcon.style.display = "none";
                    editIcon.style.display = "inline";
                } else {
                    const textarea = document.createElement("textarea");
                    textarea.className = "card-body";
                    textarea.placeholder = "Enter description...";
                    textarea.innerHTML = cardBody.innerHTML;
                    card.replaceChild(textarea, cardBody);
                    cardBody = textarea;
                    viewAsHtmlIcon.style.display = "inline";
                    editIcon.style.display = "none";
                }
            });


            editIcon.addEventListener("click", () => {
                if (cardBody.tagName === "DIV") {
                    const textarea = document.createElement("textarea");
                    textarea.className = "card-body";
                    textarea.placeholder = "Enter description...";
                    textarea.value = cardBody.innerText;
                    card.replaceChild(textarea, cardBody);
                    cardBody = textarea;
                    viewAsHtmlIcon.style.display = "inline";
                    editIcon.style.display = "none";
                } else {
                    const newCardBody = document.createElement("div");
                    newCardBody.className = "card-body";
                    newCardBody.innerHTML = cardBody.value;
                    if (card.contains(cardBody)) {
                    card.replaceChild(newCardBody, cardBody);
                    } else {
                    card.appendChild(newCardBody);
                    }
                    cardBody = newCardBody;
                    viewAsHtmlIcon.style.display = "inline";
                    editIcon.style.display = "none";
                }
            });



            return card;
        }


        function sanitizeHTML(html) {
            const temp = document.createElement("div");
            temp.innerHTML = html;
            const tagsToKeep = ['b', 'u', 'i', 'strike', 'ul', 'li'];
            const tags = temp.getElementsByTagName("*");

            for (let i = tags.length - 1; i >= 0; i--) {
                const tag = tags[i];
                if (tagsToKeep.indexOf(tag.tagName.toLowerCase()) === -1) {
                    tag.outerHTML = tag.innerHTML;
                }
            }
            return temp.innerHTML;
        }


        document.querySelectorAll(".quadrant").forEach(quadrant => {
            quadrant.addEventListener("dragover", (e) => {
                e.preventDefault();
            });

            quadrant.addEventListener("drop", (e) => {
                e.preventDefault();
                const cardId = e.dataTransfer.getData("text");
                const card = document.getElementById(cardId);
                if (!card) {
                    const draggedCard = document.querySelector('.dragging');
                    quadrant.appendChild(draggedCard);
                } else {
                    quadrant.appendChild(card);
                }
            });

            quadrant.addEventListener("dragenter", (e) => {
                e.preventDefault();
            });
        });

        document.addEventListener("dragstart", (e) => {
            if (e.target.classList.contains("card")) {
                e.target.classList.add("dragging");
                e.dataTransfer.setData("text/plain", e.target.id);
            }
        });

        document.addEventListener("dragend", (e) => {
            if (e.target.classList.contains("card")) {
                e.target.classList.remove("dragging");
            }
        });

    </script>
</body>
</html>
